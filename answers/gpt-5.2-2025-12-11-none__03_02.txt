{
  "bpmn": {
    "version": "2.0",
    "process": {
      "id": "Process_CustomerSupportTicket",
      "name": "Customer Support Ticket Handling",
      "isExecutable": true,
      "nodes": [
        {
          "id": "StartEvent_EmailReceived",
          "type": "startEvent",
          "name": "Support E-mail Received",
          "eventDefinition": {
            "type": "message",
            "messageRef": "Message_SupportEmail"
          }
        },
        {
          "id": "SubProcess_TicketLifecycle",
          "type": "subProcess",
          "name": "Ticket Lifecycle (Cancelable Before Closure)",
          "triggeredByEvent": false,
          "nodes": [
            {
              "id": "Task_ParseEmailCreateTicket",
              "type": "serviceTask",
              "name": "Parse E-mail and Create Ticket",
              "implementation": "helpdesk:createTicket"
            },
            {
              "id": "Task_InitialClassification",
              "type": "userTask",
              "name": "Initial Classification"
            },
            {
              "id": "Gateway_SimpleOrComplex",
              "type": "exclusiveGateway",
              "name": "Route: Simple or Complex"
            },
            {
              "id": "Task_RootCauseAnalysis",
              "type": "userTask",
              "name": "Root Cause Analysis"
            },
            {
              "id": "Task_ProvideResolution",
              "type": "userTask",
              "name": "Provide Resolution"
            },
            {
              "id": "Gateway_Fork_ResponseAndKB",
              "type": "parallelGateway",
              "name": "Parallel: Reply Customer and Log Solution"
            },
            {
              "id": "Task_SendResponseToCustomer",
              "type": "sendTask",
              "name": "Send Response to Customer",
              "messageRef": "Message_ResponseToCustomer"
            },
            {
              "id": "Task_LogSolutionInKB",
              "type": "userTask",
              "name": "Log Solution in Knowledge Base"
            },
            {
              "id": "Gateway_Join_ResponseAndKB",
              "type": "parallelGateway",
              "name": "Join"
            },
            {
              "id": "Event_WaitForCustomerReply",
              "type": "intermediateCatchEvent",
              "name": "Wait up to 24h for Customer Reply",
              "eventDefinitions": [
                {
                  "type": "message",
                  "messageRef": "Message_CustomerReply"
                },
                {
                  "type": "timer",
                  "timeDuration": "PT24H"
                }
              ]
            },
            {
              "id": "Gateway_ReplyOrTimeout",
              "type": "exclusiveGateway",
              "name": "Reply received?"
            },
            {
              "id": "Task_CloseTicket_Immediate",
              "type": "serviceTask",
              "name": "Close Ticket",
              "implementation": "helpdesk:closeTicket"
            },
            {
              "id": "Task_SendReminder",
              "type": "sendTask",
              "name": "Send Reminder",
              "messageRef": "Message_ReminderToCustomer"
            },
            {
              "id": "Task_CloseTicket_AfterReminder",
              "type": "serviceTask",
              "name": "Close Ticket",
              "implementation": "helpdesk:closeTicket"
            },
            {
              "id": "EndEvent_NormalClosure",
              "type": "endEvent",
              "name": "Ticket Closed"
            }
          ],
          "boundaryEvents": [
            {
              "id": "BoundaryEvent_CustomerCancels",
              "type": "boundaryEvent",
              "name": "Customer Cancels Ticket",
              "attachedToRef": "SubProcess_TicketLifecycle",
              "cancelActivity": true,
              "eventDefinition": {
                "type": "message",
                "messageRef": "Message_CustomerCancellation"
              },
              "outgoing": [
                {
                  "id": "Flow_Cancel_To_Terminate",
                  "sourceRef": "BoundaryEvent_CustomerCancels",
                  "targetRef": "EndEvent_Terminate"
                }
              ]
            }
          ]
        },
        {
          "id": "EndEvent_Terminate",
          "type": "endEvent",
          "name": "Terminate",
          "eventDefinition": {
            "type": "terminate"
          }
        }
      ],
      "sequenceFlows": [
        {
          "id": "Flow_Start_To_Sub",
          "sourceRef": "StartEvent_EmailReceived",
          "targetRef": "SubProcess_TicketLifecycle"
        },
        {
          "id": "Flow_Sub_To_End",
          "sourceRef": "SubProcess_TicketLifecycle",
          "targetRef": "EndEvent_NormalClosure"
        }
      ],
      "subProcessSequenceFlows": [
        {
          "id": "Flow_Parse_To_Classify",
          "sourceRef": "Task_ParseEmailCreateTicket",
          "targetRef": "Task_InitialClassification"
        },
        {
          "id": "Flow_Classify_To_Gateway",
          "sourceRef": "Task_InitialClassification",
          "targetRef": "Gateway_SimpleOrComplex"
        },
        {
          "id": "Flow_Simple_To_Resolution",
          "sourceRef": "Gateway_SimpleOrComplex",
          "targetRef": "Task_ProvideResolution",
          "conditionExpression": "classification == 'Simple'"
        },
        {
          "id": "Flow_Complex_To_RCA",
          "sourceRef": "Gateway_SimpleOrComplex",
          "targetRef": "Task_RootCauseAnalysis",
          "conditionExpression": "classification == 'Complex'"
        },
        {
          "id": "Flow_RCA_To_Resolution",
          "sourceRef": "Task_RootCauseAnalysis",
          "targetRef": "Task_ProvideResolution"
        },
        {
          "id": "Flow_Resolution_To_Fork",
          "sourceRef": "Task_ProvideResolution",
          "targetRef": "Gateway_Fork_ResponseAndKB"
        },
        {
          "id": "Flow_Fork_To_SendResponse",
          "sourceRef": "Gateway_Fork_ResponseAndKB",
          "targetRef": "Task_SendResponseToCustomer"
        },
        {
          "id": "Flow_Fork_To_LogKB",
          "sourceRef": "Gateway_Fork_ResponseAndKB",
          "targetRef": "Task_LogSolutionInKB"
        },
        {
          "id": "Flow_SendResponse_To_Join",
          "sourceRef": "Task_SendResponseToCustomer",
          "targetRef": "Gateway_Join_ResponseAndKB"
        },
        {
          "id": "Flow_LogKB_To_Join",
          "sourceRef": "Task_LogSolutionInKB",
          "targetRef": "Gateway_Join_ResponseAndKB"
        },
        {
          "id": "Flow_Join_To_Wait",
          "sourceRef": "Gateway_Join_ResponseAndKB",
          "targetRef": "Event_WaitForCustomerReply"
        },
        {
          "id": "Flow_Wait_To_Decide",
          "sourceRef": "Event_WaitForCustomerReply",
          "targetRef": "Gateway_ReplyOrTimeout"
        },
        {
          "id": "Flow_Reply_To_CloseImmediate",
          "sourceRef": "Gateway_ReplyOrTimeout",
          "targetRef": "Task_CloseTicket_Immediate",
          "conditionExpression": "event == 'Message_CustomerReply'"
        },
        {
          "id": "Flow_CloseImmediate_To_End",
          "sourceRef": "Task_CloseTicket_Immediate",
          "targetRef": "EndEvent_NormalClosure"
        },
        {
          "id": "Flow_Timeout_To_Reminder",
          "sourceRef": "Gateway_ReplyOrTimeout",
          "targetRef": "Task_SendReminder",
          "conditionExpression": "event == 'Timer_PT24H'"
        },
        {
          "id": "Flow_Reminder_To_CloseAfterReminder",
          "sourceRef": "Task_SendReminder",
          "targetRef": "Task_CloseTicket_AfterReminder"
        },
        {
          "id": "Flow_CloseAfterReminder_To_End",
          "sourceRef": "Task_CloseTicket_AfterReminder",
          "targetRef": "EndEvent_NormalClosure"
        }
      ]
    },
    "messages": [
      {
        "id": "Message_SupportEmail",
        "name": "Support E-mail"
      },
      {
        "id": "Message_ResponseToCustomer",
        "name": "Response to Customer"
      },
      {
        "id": "Message_CustomerReply",
        "name": "Customer Reply"
      },
      {
        "id": "Message_ReminderToCustomer",
        "name": "Reminder"
      },
      {
        "id": "Message_CustomerCancellation",
        "name": "Customer Cancellation"
      }
    ]
  }
}